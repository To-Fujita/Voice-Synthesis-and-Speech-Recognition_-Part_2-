<!doctype html>
<html>
  <head>
      <meta charset="utf-8">
      <title>Voice Synthesis - 2021/01/31 by T. Fujita</title>
      <link rel="stylesheet" href="./css/Slider.css">
  </head>
  <style>
    body {
      background-image: url(./Data/josue-soto-bsmCBJwAbPw-2615x1743.jpg);
      background-size: cover;
    }
  </style>  
  <body>
    <center>
      <font color="white">
        <h2>éŸ³å£°åˆæˆãƒ†ã‚¹ãƒˆï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®å¯¾å¿œï¼ä¸å¯¾å¿œã¯ã€èµ·å‹•æ™‚ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ï¼‰</h2>
      </font>   
    </br>
      <textarea id="text" rows= "5" cols="60">ã“ã‚Œã¯ã€èª­ã¿ä¸Šã’ãƒ†ã‚¹ãƒˆã§ã™ã€‚ã€€æœ¬æ—¥ã¯ã€æ™´å¤©ãªã‚Šã€‚ã€€ã“ã“ã«å…¥åŠ›ã—ãŸæ–‡ç« ã‚’è©±ã—ã¾ã™ã€‚</textarea>
      <br/>
      <select id="voice-select"></select>
      <br/><br/>
      <input id="rate" type="range" class="R_range" min="0" max="2" step="0.2" value="1"><font color="white"> (speed: <span id="current-speed" >1.0</span>)</font>
      <br/>
      <input id="pitch" type="range" class="B_range" min="0" max="2" step="0.2" value="1"><font color="white"> (pitch : <span id="current-pitch">1.0</span>)</font>
      <br/><br/>
      <input type="submit" value="å†ã€€ç”Ÿ" onclick="Play()">ã€€ã€€
      <input type="submit" value="ä¸€æ™‚åœæ­¢" onclick="Pause()">ã€€ã€€
      <input type="submit" value="å†ã€€é–‹" onclick="Resume()">ã€€ã€€
      <input type="submit" value="åœã€€æ­¢" onclick="Stop()">
    </center>
    <script type = "text/javascript">
// Check for browser support
      if ('speechSynthesis' in window) {
        alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°åˆæˆã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚ğŸ˜„")
      } else {
        alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°åˆæˆã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚ğŸ˜¢")
      }

      const uttr = new SpeechSynthesisUtterance();
      const voiceSelect = document.querySelector('#voice-select')
      const speed = document.getElementById('rate')
      const currentValueElem = document.getElementById('current-speed')
      const pitch_val = document.getElementById('pitch')
      const currentPitchElem = document.getElementById('current-pitch')
      const textData = document.querySelector('#text')
      
      appendVoices()

      speechSynthesis.onvoiceschanged = e => {
        appendVoices()
      }

      var rangeValue = function (elem, target) {
        return function(evt) {
          target.innerHTML = elem.value
        }
      }

      speed.addEventListener('input', rangeValue(speed, currentValueElem))
      pitch_val.addEventListener('input', rangeValue(pitch_val, currentPitchElem))

      function Play() {
        uttr.text = textData.value;
        uttr.rate = speed.value;
        uttr.pitch = pitch_val.value;
        uttr.voice = speechSynthesis.getVoices().filter(voice => voice.name === voiceSelect.value) [0]
        speechSynthesis.speak(uttr)
      }

      function Stop() {
        speechSynthesis.cancel()
      }

      function Pause() {
        speechSynthesis.pause()
      }

      function Resume() {
        speechSynthesis.resume()
      }

      function appendVoices() {
        const voices = speechSynthesis.getVoices()
        voiceSelect.innerHTML = ''
        voices.forEach(voice => {
        // æ—¥æœ¬èªã¨è‹±èªä»¥å¤–ã®å£°ã¯é¸æŠè‚¢ã«è¿½åŠ ã—ãªã„ã€‚
          if(!voice.lang.match('ja|en-US')) return
          const option = document.createElement('option')
          option.value = voice.name
          option.text  = `${voice.name} (${voice.lang})`
          option.setAttribute('selected', voice.default)
          voiceSelect.appendChild(option)
        });
      }
  
    </script>
  </body>
</html>
